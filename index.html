<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Grew Energy Pvt. Ltd.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Arial;margin:0;background:#f4f6f9}
header{background:#0b3c5d;color:#fff;padding:15px;display:flex;justify-content:space-between}
button{padding:10px;margin:5px}
.card{background:#fff;padding:15px;margin:10px;border-radius:8px}
.hidden{display:none}
input,textarea{width:100%;padding:8px;margin:5px 0}
</style>
</head>

<body>

<header>
  <b>Grew Energy Pvt. Ltd.</b>
  <button onclick="logout()">Logout</button>
</header>

<div id="auth">
  <div class="card">
    <h3>Login / Register</h3>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
  </div>
</div>

<div id="dashboard" class="hidden">
  <div class="card">
    <h3>Dashboard</h3>
    <button onclick="showAdmin()">Admin Panel</button>
    <button onclick="showTickets()">Tickets</button>
    <button onclick="showChat()">Live Chat</button>
  </div>
</div>

<div id="admin" class="hidden card">
  <h3>Admin Panel</h3>
  <p>Only Admin can see this</p>
</div>

<div id="tickets" class="hidden card">
  <h3>Raise Ticket</h3>
  <input id="subject" placeholder="Subject">
  <textarea id="message" placeholder="Message"></textarea>
  <button onclick="createTicket()">Submit</button>
  <div id="ticketList"></div>
</div>

<div id="chat" class="hidden card">
  <h3>Live Chat</h3>
  <input id="chatMsg" placeholder="Type message">
  <button onclick="sendMsg()">Send</button>
  <div id="chatBox"></div>
</div>

<script>
const supabase = supabase.createClient(
  "https://drjkjnqzldxsyhdzeoe.supabase.co",
  "YOUR_ANON_KEY_HERE"
);

async function register(){
  const { data, error } = await supabase.auth.signUp({
    email: email.value,
    password: password.value
  });
  alert("Registered. Check email.");
}

async function login(){
  const { data, error } = await supabase.auth.signInWithPassword({
    email: email.value,
    password: password.value
  });
  if(error){ alert(error.message); return;}
  auth.classList.add("hidden");
  dashboard.classList.remove("hidden");
}

async function logout(){
  await supabase.auth.signOut();
  location.reload();
}

async function showAdmin(){
  admin.classList.remove("hidden");
}

async function createTicket(){
  await supabase.from("tickets").insert({
    subject: subject.value,
    message: message.value
  });
  alert("Ticket created");
}

async function showChat(){
  chat.classList.remove("hidden");
}

async function sendMsg(){
  await supabase.from("chat_messages").insert({
    message: chatMsg.value
  });
}

supabase.channel('chat')
.on('postgres_changes',
  {event:'INSERT',schema:'public',table:'chat_messages'},
  payload=>{
    chatBox.innerHTML += `<p>${payload.new.message}</p>`
  }
).subscribe();
</script>

</body>
</html>
